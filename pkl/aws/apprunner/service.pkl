/// AWS::AppRunner::Service
///
/// Generated by rain build --pkl-class AWS::AppRunner::Service
module aws.apprunner.service

import "../../cloudformation.pkl"

/// 
open class ServiceTag {
    Value: (String|Mapping)?
    Key: (String|Mapping)?
}

typealias SourceCodeVersionType = "BRANCH"

/// Source Code Version
open class ServiceSourceCodeVersion {
    Type: SourceCodeVersionType|Mapping
    Value: String|Mapping
}

typealias EgressConfigurationEgressType = "DEFAULT"|"VPC"

/// Network egress configuration
open class ServiceEgressConfiguration {
    EgressType: EgressConfigurationEgressType|Mapping
    VpcConnectorArn: (String(matches(Regex(#"arn:aws(-[\w]+)*:[a-z0-9-\\.]{0,63}:[a-z0-9-\\.]{0,63}:[0-9]{12}:(\w|\/|-){1,1011}"#)))|Mapping)?
}

/// Source Code configuration
open class ServiceSourceConfiguration {
    ImageRepository: (ServiceImageRepository)?
    AutoDeploymentsEnabled: (Boolean|Mapping)?
    AuthenticationConfiguration: (ServiceAuthenticationConfiguration)?
    CodeRepository: (ServiceCodeRepository)?
}

/// Authentication Configuration
open class ServiceAuthenticationConfiguration {
    ConnectionArn: (String(matches(Regex(#"arn:aws(-[\w]+)*:[a-z0-9-\\.]{0,63}:[a-z0-9-\\.]{0,63}:[0-9]{12}:(\w|\/|-){1,1011}"#)))|Mapping)?
    AccessRoleArn: (ServiceRoleArn)?
}

typealias CodeConfigurationConfigurationSource = "REPOSITORY"|"API"

/// Code Configuration
open class ServiceCodeConfiguration {
    ConfigurationSource: CodeConfigurationConfigurationSource|Mapping
    CodeConfigurationValues: (ServiceCodeConfigurationValues)?
}

typealias HealthCheckConfigurationProtocol = "TCP"|"HTTP"

/// Health check configuration
open class ServiceHealthCheckConfiguration {
    Interval: (Int|Mapping)?
    Timeout: (Int|Mapping)?
    HealthyThreshold: (Int|Mapping)?
    UnhealthyThreshold: (Int|Mapping)?
    Protocol: (HealthCheckConfigurationProtocol|Mapping)?
    Path: (String|Mapping)?
}

/// 
open class ServiceKeyValuePair {
    Name: (String|Mapping)?
    Value: (String|Mapping)?
}

/// Source Code Repository
open class ServiceCodeRepository {
    RepositoryUrl: String|Mapping
    SourceCodeVersion: ServiceSourceCodeVersion
    CodeConfiguration: (ServiceCodeConfiguration)?
    SourceDirectory: (String(matches(Regex(#"[^\x00]+"#)))|Mapping)?
}

/// Service observability configuration
open class ServiceServiceObservabilityConfiguration {
    ObservabilityEnabled: Boolean|Mapping
    ObservabilityConfigurationArn: (String(matches(Regex(#"arn:aws(-[\w]+)*:[a-z0-9-\.]{0,63}:[a-z0-9-\.]{0,63}:[0-9]{12}:(\w|/|-){1,1011}"#)))|Mapping)?
}

typealias CodeConfigurationValuesRuntime = "PYTHON_3"|"NODEJS_12"|"NODEJS_14"|"CORRETTO_8"|"CORRETTO_11"|"NODEJS_16"|"GO_1"|"DOTNET_6"|"PHP_81"|"RUBY_31"|"PYTHON_311"|"NODEJS_18"

/// Code Configuration Values
open class ServiceCodeConfigurationValues {
    StartCommand: (String|Mapping)?
    Port: (String|Mapping)?
    RuntimeEnvironmentVariables: (Listing<ServiceKeyValuePair>)?
    RuntimeEnvironmentSecrets: (Listing<ServiceKeyValuePair>)?
    Runtime: CodeConfigurationValuesRuntime|Mapping
    BuildCommand: (String|Mapping)?
}

/// Instance Configuration
open class ServiceInstanceConfiguration {
    Cpu: (String(matches(Regex(#"256|512|1024|2048|4096|(0.25|0.5|1|2|4) vCPU"#)))|Mapping)?
    Memory: (String(matches(Regex(#"512|1024|2048|3072|4096|6144|8192|10240|12288|(0.5|1|2|3|4|6|8|10|12) GB"#)))|Mapping)?
    InstanceRoleArn: (ServiceRoleArn)?
}

/// Encryption configuration (KMS key)
open class ServiceEncryptionConfiguration {
    KmsKey: String(matches(Regex(#"arn:aws(-[\w]+)*:kms:[a-z\-]+-[0-9]{1}:[0-9]{12}:key\/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"#)))|Mapping
}

typealias ServiceRoleArn = String|Mapping


/// Network ingress configuration
open class ServiceIngressConfiguration {
    IsPubliclyAccessible: Boolean|Mapping
}

typealias ImageRepositoryImageRepositoryType = "ECR"|"ECR_PUBLIC"

/// Image Repository
open class ServiceImageRepository {
    ImageIdentifier: String(matches(Regex(#"([0-9]{12}.dkr.ecr.[a-z\-]+-[0-9]{1}.amazonaws.com\/.*)|(^public\.ecr\.aws\/.+\/.+)"#)))|Mapping
    ImageConfiguration: (ServiceImageConfiguration)?
    ImageRepositoryType: ImageRepositoryImageRepositoryType|Mapping
}

/// Image Configuration
open class ServiceImageConfiguration {
    StartCommand: (String|Mapping)?
    Port: (String|Mapping)?
    RuntimeEnvironmentVariables: (Listing<ServiceKeyValuePair>)?
    RuntimeEnvironmentSecrets: (Listing<ServiceKeyValuePair>)?
}

typealias NetworkConfigurationIpAddressType = "IPV4"|"DUAL_STACK"

/// Network configuration
open class ServiceNetworkConfiguration {
    EgressConfiguration: (ServiceEgressConfiguration)?
    IngressConfiguration: (ServiceIngressConfiguration)?
    IpAddressType: (NetworkConfigurationIpAddressType|Mapping)?
}

/// The AWS::AppRunner::Service resource specifies an AppRunner Service.
open class Service extends cloudformation.Resource {

    Type = "AWS::AppRunner::Service"


    /// 
    hidden InstanceConfiguration: (ServiceInstanceConfiguration)?

    /// 
    hidden HealthCheckConfiguration: (ServiceHealthCheckConfiguration)?

    /// 
    hidden ObservabilityConfiguration: (ServiceServiceObservabilityConfiguration)?

    /// 
    hidden NetworkConfiguration: (ServiceNetworkConfiguration)?

    /// The AppRunner Service Name.
    hidden ServiceName: (String(matches(Regex(#"[A-Za-z0-9][A-Za-z0-9-_]{3,39}"#)))|Mapping)?

    /// 
    hidden EncryptionConfiguration: (ServiceEncryptionConfiguration)?

    /// Autoscaling configuration ARN
    hidden AutoScalingConfigurationArn: (String(matches(Regex(#"arn:aws(-[\w]+)*:[a-z0-9-\\.]{0,63}:[a-z0-9-\\.]{0,63}:[0-9]{12}:(\w|\/|-){1,1011}"#)))|Mapping)?

    /// 
    hidden SourceConfiguration: ServiceSourceConfiguration

    /// 
    hidden Tags: (Listing<ServiceTag>)?

    Properties {
        ["InstanceConfiguration"] = if (InstanceConfiguration == null) null else InstanceConfiguration
        ["HealthCheckConfiguration"] = if (HealthCheckConfiguration == null) null else HealthCheckConfiguration
        ["ObservabilityConfiguration"] = if (ObservabilityConfiguration == null) null else ObservabilityConfiguration
        ["NetworkConfiguration"] = if (NetworkConfiguration == null) null else NetworkConfiguration
        ["ServiceName"] = if (ServiceName == null) null else ServiceName
        ["EncryptionConfiguration"] = if (EncryptionConfiguration == null) null else EncryptionConfiguration
        ["AutoScalingConfigurationArn"] = if (AutoScalingConfigurationArn == null) null else AutoScalingConfigurationArn
        ["SourceConfiguration"] = if (SourceConfiguration == null) null else SourceConfiguration
        ["Tags"] = if (Tags == null) null else Tags
    }

}
