// Represents a CloudFormation template that creates buckets

amends "modules/template.pkl"
import "modules/aws/s3/bucket.pkl" as bucket
import "modules/patterns/bucket.pkl" as pattern

Description = "Create a bucket"

Metadata { 
    ["Foo"] = "bar"
}

Parameters {
    ["Name"] {
        Type = "String"
        Default = "baz"
    }
}

Resources {
    ["UntypedBucket"] {
        Type = "AWS::S3::Bucket"
        Properties {
           ["BucketName"] {
                ["Ref"] = "Name"
           }
        }
    }

    ["TypedBucket1"] = new bucket.Bucket {
        BucketName = "foo"
    }

    ["TypedBucket2"] = new bucket.Bucket {
        BucketName = Ref("Name")
    }

    for (name in List("bucketx", "buckety", "bucketz")) {
        [name] = new bucket.Bucket {
            BucketName = name
        }
    }

    // Import multiple resources from a pattern module 
    for (_key, _val in pattern.resources("my-app")) {
        ["My" + _key] = _val
    }

}

output {
    renderer = new YamlRenderer {}
}


