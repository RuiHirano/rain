amends "modules/template.pkl"
import "modules/cloudformation.pkl" as cfn
import "modules/aws/lambda/function.pkl" as func
import "modules/aws/dynamodb/table.pkl"
import "modules/aws/iam/role.pkl"
import "modules/aws/iam/policy.pkl"

local function arn(svc:String, id:String): String = 
    cfn.Sub("arn:${AWS::Partition}:\(svc):${AWS::Region}:${AWS::AccountId}:\(id)")


local funcRole = new role.Role {
    AssumeRolePolicyDocument {
        Statement = new Statement {
            Action {
                "sts:AssumeRole"
            }
            Principal {
                Service = new Listing {
                    "lambda.amazonaws.com"
                }
            }
        }
        Version = "2012-10-17"
    }
    Policies = {
        PolicyDocument {
            Statement = new Statement {
                Action {
                    "logs:CreateLogGroup"
                    "logs:CreateLogStream"
                    "logs:PutLogEvents"
                }
                Resource {
                    arn("logs", "log-group:/aws/lambda/*")
                }
            }
            PolicyName = "LambdaFunctionServiceRolePolicy"
        }
    }
    Path = "/"
}

local myLambda = new func.Function {

}

local myTable = new table.Table {

}

Resources {

    ["MyLambda"] = myLambda

    ["MyTable"] = myTable

}


